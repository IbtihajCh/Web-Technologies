<div class="checkout-page">
    <div class="checkout-main-content">
        <div class="checkout-form-section">
            <form action="/cart/checkout" method="POST" id="checkoutForm" class="checkout-form" autocomplete="on" novalidate>
                <h1 class="checkout-heading">Checkout</h1>
                <!-- Contact Information -->
                <div class="form-block">
                    <h2>Contact</h2>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" required autocomplete="email">
                        <span class="error-message"></span>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="email-news" name="email-news">
                        <label for="email-news">Email me with news and offers</label>
                    </div>
                </div>
                <!-- Delivery Information -->
                <div class="form-block">
                    <h2>Delivery</h2>
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" name="fullName" id="fullName" required pattern="[A-Za-z ]+" autocomplete="name">
                        <span class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" name="address" id="address" required autocomplete="street-address">
                        <span class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" name="phone" id="phone" required pattern="[0-9]{10,12}" autocomplete="tel">
                        <span class="error-message"></span>
                    </div>
                </div>
                <!-- Payment Information -->
                <div class="form-block">
                    <h2>Payment</h2>
                    <div class="payment-methods-radio">
                        <label class="payment-option-label">
                            <input type="radio" name="paymentMethod" value="card" id="paymentCard" checked>
                            Credit or Debit Card
                            <div class="card-icons">
                                <img src="/assets/visa.png" alt="Visa" onerror="this.style.display='none'">
                                <img src="/assets/mastercard.png" alt="Mastercard" onerror="this.style.display='none'">
                                <img src="/assets/amex.png" alt="American Express" onerror="this.style.display='none'">
                                <img src="/assets/discover.png" alt="Discover" onerror="this.style.display='none'">
                            </div>
                        </label>
                        <label class="payment-option-label">
                            <input type="radio" name="paymentMethod" value="cod" id="paymentCod">
                            Cash on Delivery
                        </label>
                    </div>
                    <div id="cardFields" class="card-fields">
                        <div class="form-group">
                            <label for="cardNumber">Card number</label>
                            <input type="text" name="cardNumber" id="cardNumber" maxlength="16" pattern="\d{16}" autocomplete="cc-number">
                            <span class="error-message"></span>
                        </div>
                        <div class="form-group-inline">
                            <div class="form-group">
                                <label for="cardExpiry">Expiration date (MM / YY)</label>
                                <input type="text" name="cardExpiry" id="cardExpiry" maxlength="5" pattern="(0[1-9]|1[0-2])\s?/\s?([0-9]{2})" placeholder="MM / YY" autocomplete="cc-exp">
                                <span class="error-message"></span>
                            </div>
                            <div class="form-group">
                                <label for="cardCVV">Security code</label>
                                <input type="text" name="cardCVV" id="cardCVV" maxlength="3" pattern="\d{3}" autocomplete="cc-csc">
                                <span class="error-message"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nameOnCard">Name on card</label>
                            <input type="text" name="nameOnCard" id="nameOnCard" autocomplete="cc-name">
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="shipping-billing-address" name="shipping-billing-address" checked>
                        <label for="shipping-billing-address">Use shipping address as billing address</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="more-payment-options" name="more-payment-options">
                        <label for="more-payment-options">More Payment Options</label>
                    </div>
                </div>
                <!-- Remember Me -->
                <div class="form-block">
                    <h2>Remember me</h2>
                    <div class="checkbox-group">
                        <input type="checkbox" id="remember-me" name="remember-me">
                        <label for="remember-me">Save my information for a faster checkout with a Shop account</label>
                    </div>
                    <div class="form-group">
                        <label for="mobile-phone-number">Mobile phone number</label>
                        <input type="tel" name="mobilePhoneNumber" id="mobile-phone-number" autocomplete="tel-national">
                    </div>
                </div>
                <button type="submit" class="place-order-btn">Place Order</button>
            </form>
        </div>
        <!-- Order Summary Section (Right Column) -->
        <div class="order-summary-section">
            <div class="order-summary-card">
                <h2>Order Summary</h2>
                <div class="order-items-list">
                    <% cart.forEach(function(item) { %>
                        <div class="order-summary-item">
                            <div class="item-image">
                                <img src="<%= item.image || '/assets/logo.png' %>" alt="<%= item.name %>">
                                <span class="item-quantity-badge"><%= item.quantity %></span>
                            </div>
                            <div class="item-details">
                                <p class="item-name"><%= item.name %></p>
                                <p class="item-variant"><%= item.size %></p>
                            </div>
                            <div class="item-price"><span class="js-price" data-pkr="<%= item.price %>"></span></div>
                        </div>
                    <% }); %>
                </div>
                <div class="discount-section">
                    <input type="text" placeholder="Discount code or gift card">
                    <button type="button" class="apply-btn">Apply</button>
                </div>
                <div class="order-summary-totals">
                    <div class="total-line">
                        <span>Subtotal</span>
                        <span><span class="js-price" data-pkr="<%= total %>"></span></span>
                    </div>
                    <div class="total-line">
                        <span>Shipping</span>
                        <span><span class="js-price" data-pkr="5534"></span></span>
                    </div>
                    <div class="total-line">
                        <span>Duties</span>
                        <span><span class="js-price" data-pkr="30764"></span></span>
                    </div>
                    <div class="total-line">
                        <span>Taxes</span>
                        <span><span class="js-price" data-pkr="40120"></span></span>
                    </div>
                    <div class="total-line grand-total">
                        <strong>Total</strong>
                        <strong><span class="js-price" data-pkr="<%= (total + 5534 + 30764 + 40120) %>"></span></strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/checkout.js"></script>
<script src="/js/currency.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const paymentRadios = document.querySelectorAll('input[name="paymentMethod"]');
    const cardFields = document.getElementById('cardFields');
    paymentRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            cardFields.style.display = this.value === 'card' ? 'block' : 'none';
        });
    });
    // Client-side validation
    const form = document.getElementById('checkoutForm');
    form.addEventListener('submit', function(e) {
        let errors = [];
        const name = form.name.value.trim();
        const phone = form.phone.value.trim();
        const address = form.address.value.trim();
        const paymentMethod = form.paymentMethod.value;
        if (!name) errors.push('Full Name is required.');
        if (!phone) errors.push('Phone Number is required.');
        if (!address) errors.push('Address is required.');
        if (paymentMethod === 'card') {
            const cardNumber = form.cardNumber.value.trim();
            const cardExpiry = form.cardExpiry.value.trim();
            const cardCVV = form.cardCVV.value.trim();
            if (!/^\d{16}$/.test(cardNumber)) errors.push('Valid 16-digit card number required.');
            if (!/^\d{2}\/\d{2}$/.test(cardExpiry)) errors.push('Valid expiry (MM/YY) required.');
            if (!/^\d{3}$/.test(cardCVV)) errors.push('Valid 3-digit CVV required.');
        }
        if (errors.length > 0) {
            alert(errors.join('\n'));
            e.preventDefault();
        }
    });
});

function updatePrices() {
  var currency = window.currencyUtils.getCurrency();
  document.querySelectorAll('.js-price').forEach(function(el) {
    var pkr = parseFloat(el.getAttribute('data-pkr'));
    el.textContent = window.currencyUtils.formatPrice(pkr, currency);
  });
}
window.addEventListener('currencyChange', updatePrices);
document.addEventListener('DOMContentLoaded', updatePrices);
</script>

<style>
.checkout-section {
    padding: 2rem 0;
    max-width: 1200px;
    margin: 0 auto;
}

.checkout-heading {
    text-align: center;
    margin-bottom: 2rem;
    font-size: 2.5rem;
    color: #333;
}

.checkout-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: start;
}

.checkout-form h2,
.order-summary h2 {
    margin-bottom: 1.5rem;
    color: #333;
    border-bottom: 2px solid #eee;
    padding-bottom: 0.5rem;
}

.form-group {
    margin-bottom: 1.2rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #333;
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.2s;
}

.form-input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

textarea.form-input {
    resize: vertical;
    min-height: 100px;
}

.payment-info {
    margin: 2rem 0;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.payment-info h3 {
    margin-bottom: 1rem;
    color: #333;
}

.payment-method {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.payment-icon {
    font-size: 2rem;
}

.payment-details p {
    margin: 0.25rem 0 0 0;
    color: #666;
    font-size: 0.9rem;
}

.place-order-btn {
    width: 100%;
    background: #28a745;
    color: white;
    border: none;
    padding: 1rem;
    border-radius: 4px;
    font-size: 1.1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    margin-top: 1rem;
}

.place-order-btn:hover {
    background: #218838;
}

.order-summary {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    position: sticky;
    top: 2rem;
}

.order-items {
    margin-bottom: 1.5rem;
}

.order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid #eee;
}

.order-item:last-child {
    border-bottom: none;
}

.item-info {
    flex: 1;
}

.item-name {
    font-weight: 500;
    color: #333;
    margin-bottom: 0.25rem;
}

.item-details {
    display: flex;
    gap: 1rem;
    font-size: 0.9rem;
    color: #666;
}

.item-total {
    font-weight: 500;
    color: #333;
}

.order-total {
    border-top: 2px solid #eee;
    padding-top: 1rem;
    margin-bottom: 1.5rem;
}

.total-line {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    color: #666;
}

.total-final {
    font-size: 1.1rem;
    color: #333;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.order-notes {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 4px;
    padding: 1rem;
}

.order-notes p {
    margin: 0 0 0.5rem 0;
    color: #856404;
}

.order-notes ul {
    margin: 0;
    padding-left: 1.5rem;
    color: #856404;
}

.order-notes li {
    margin-bottom: 0.25rem;
}

.payment-methods {
    display: flex;
    gap: 2rem;
    margin-bottom: 1rem;
}

.modern-btn {
    background: #222;
    color: #fff;
    border: none;
    border-radius: 24px;
    padding: 0.8rem 2.2rem;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: 0.03em;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
}

.modern-btn:hover {
    background: #444;
    color: #fff;
}

@media (max-width: 768px) {
    .checkout-container {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .order-summary {
        position: static;
    }
    
    .checkout-heading {
        font-size: 2rem;
    }
}

.card-icons img {
    height: 28px;
    width: auto;
    margin-right: 4px;
    background: #fff;
    border-radius: 4px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    object-fit: contain;
    display: inline-block;
}
</style> 